<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tr√≤ chuy·ªán v·ªõi Linh ƒêan</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #ff6b9d;
        --secondary-color: #ffb3c6;
        --background-light: #fff9fc;
        --text-dark: #333333;
        --chat-bg: #fff;
        --message-sent: #e1f5fe;
        --message-received: #fce4ec;
      }

      body {
        background-color: var(--background-light);
        font-family: "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
        color: var(--text-dark);
        overflow-x: hidden;
      }

      .chat-container {
        background: var(--chat-bg);
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .chat-header {
        background: linear-gradient(to right, #ff6b9d, #ffb3c6);
        border-radius: 12px 12px 0 0;
      }

      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid white;
      }

      #chat-messages {
        background: var(--background-light);
        border-radius: 0;
        scrollbar-width: thin;
        scrollbar-color: var(--secondary-color) transparent;
      }

      .user-message {
        background: var(--message-sent);
        border-radius: 18px 18px 4px 18px;
        color: var(--text-dark);
        max-width: 70%;
        align-self: flex-end;
        word-break: break-word;
      }

      .ai-message {
        background: var(--message-received);
        border-radius: 18px 18px 18px 4px;
        color: var(--text-dark);
        max-width: 70%;
        align-self: flex-start;
        word-break: break-word;
      }

      .ai-message strong {
        color: #e91e63;
        font-weight: 600;
      }

      .chat-input-container {
        background-color: white;
        border-radius: 0 0 12px 12px;
        border-top: 1px solid #f0f0f0;
      }

      #message-input {
        background: white;
        border: 1px solid #e0e0e0;
        color: var(--text-dark);
        transition: all 0.3s ease;
        border-radius: 20px;
      }

      #message-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 5px rgba(255, 107, 157, 0.3);
      }

      #send-btn {
        background: var(--primary-color);
        color: white;
        transition: all 0.3s ease;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #send-btn:hover {
        background: #e91e63;
        transform: scale(1.05);
      }

      .typing-indicator {
        color: #666;
        font-style: italic;
        font-size: 0.85rem;
      }

      .message-time {
        font-size: 0.7rem;
        color: #888;
        margin-top: 2px;
      }

      /* Mobile Responsive Styles */
      @media (max-width: 768px) {
        .chat-container {
          height: 100vh;
          border-radius: 0;
          margin: 0;
        }

        .chat-header {
          border-radius: 0;
        }

        #chat-messages {
          height: calc(100vh - 130px);
        }
      }

      /* Animation for messages */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message {
        animation: fadeIn 0.3s ease-out;
      }
    </style>
  </head>
  <body class="h-screen flex items-center justify-center p-0 sm:p-4">
    <div
      class="chat-container w-full max-w-md h-full sm:h-[600px] flex flex-col"
    >
      <!-- Chat Header -->
      <div class="chat-header p-3 flex items-center">
        <img
          src="https://i.imgur.com/00PDxHB.png"
          alt="Linh ƒêan"
          class="avatar mr-3"
          onerror="this.src='https://i.imgur.com/00PDxHB.png'"
        />
        <div>
          <h2 class="text-white font-semibold">Linh ƒêan</h2>
          <div class="text-white text-xs opacity-80">ƒêang ho·∫°t ƒë·ªông</div>
        </div>
      </div>

      <!-- Chat Messages -->
      <div
        id="chat-messages"
        class="flex-1 overflow-y-auto p-4 flex flex-col space-y-3"
      ></div>

      <!-- Typing Indicator -->
      <div class="typing-indicator px-4 py-1 text-center hidden">
        Linh ƒêan ƒëang nh·∫≠p...
      </div>

      <!-- Chat Input -->
      <div class="chat-input-container p-3 flex items-center">
        <textarea
          id="message-input"
          placeholder="Nh·∫Øn tin v·ªõi Linh ƒêan..."
          rows="1"
          class="flex-grow p-3 mr-2"
        ></textarea>
        <button id="send-btn">
          <i class="ri-send-plane-fill"></i>
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const messageInput = document.getElementById("message-input");
        const sendBtn = document.getElementById("send-btn");
        const chatMessages = document.getElementById("chat-messages");
        const typingIndicator = document.querySelector(".typing-indicator");

        let messageCounter = 0;

        function getCurrentTime() {
          const now = new Date();
          return now.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });
        }

        function typeEffect(element, text, index = 0) {
          if (index === 0) {
            text = text.replace(/\n/g, "<br>");
            text = text.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
            element.dataset.fullText = text;
            element.innerHTML = "";
          }

          const fullText = element.dataset.fullText;

          if (index < fullText.length) {
            element.innerHTML = fullText.substring(0, index + 1);
            setTimeout(() => typeEffect(element, text, index + 1), 20);
          } else {
            element.innerHTML = fullText;
          }
        }

        function sanitizeHTML(text) {
          const tempDiv = document.createElement("div");
          tempDiv.textContent = text;
          return tempDiv.innerHTML;
        }

        function vibrateOnSend() {
          if ("vibrate" in navigator) {
            navigator.vibrate(50);
          }
        }

        function appendMessage(text, sender) {
          const messageDiv = document.createElement("div");
          messageDiv.classList.add(
            "message",
            `${sender}-message`,
            "p-3",
            "my-1",
            "break-words"
          );

          if (sender === "ai" && text) {
            text = text.replace(/\n/g, "<br>");
            text = text.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
          }

          const messageContent = document.createElement("div");
          messageContent.innerHTML = text;
          messageDiv.appendChild(messageContent);

          // Add timestamp
          const timeSpan = document.createElement("div");
          timeSpan.classList.add("message-time");
          timeSpan.textContent = getCurrentTime();
          messageDiv.appendChild(timeSpan);

          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
          return messageDiv;
        }

        function sendMessage() {
          const message = messageInput.value.trim();
          if (!message) return;

          appendMessage(message, "user");
          messageInput.value = "";
          messageInput.style.height = "auto";
          typingIndicator.classList.remove("hidden");
          messageCounter++;
          vibrateOnSend();

          // Simulate server response
          setTimeout(() => {
            typingIndicator.classList.add("hidden");
            const aiMessageDiv = appendMessage("", "ai");

            // Replace with your actual API call
            fetch("/chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message }),
            })
              .then((response) => response.json())
              .then((data) => {
                typeEffect(aiMessageDiv.firstChild, sanitizeHTML(data.reply));
              })
              .catch((error) => {
                console.error("Error:", error);
                typeEffect(
                  aiMessageDiv.firstChild,
                  "C√≥ l·ªói x·∫£y ra. Xin th·ª≠ l·∫°i."
                );
              });
          }, 800);
        }

        // Event Listeners
        sendBtn.addEventListener("click", sendMessage);

        messageInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });

        // Auto-resize textarea
        messageInput.addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = Math.min(this.scrollHeight, 100) + "px";
        });

        // Greet user
        setTimeout(() => {
          const aiMessageDiv = appendMessage("", "ai");
          typeEffect(
            aiMessageDiv.firstChild,
            "Xin ch√†o! M√¨nh l√† Linh ƒêan. B·∫°n mu·ªën tr√≤ chuy·ªán v·ªÅ ƒëi·ªÅu g√¨ h√¥m nay? üòä"
          );
        }, 500);
      });
    </script>
  </body>
</html>
